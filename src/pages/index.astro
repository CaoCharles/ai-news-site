---
import BaseLayout from '../layouts/BaseLayout.astro';
import HeroSection from '../components/HeroSection.astro';
import ArticleCard from '../components/ArticleCard.astro';
import ArticleGrid from '../components/ArticleGrid.astro';
import SectionTitle from '../components/SectionTitle.astro';
import CategoryStrip from '../components/CategoryStrip.astro';
import PodcastCard from '../components/PodcastCard.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts');
const sortedPosts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// 1. Hero Post (Latest)
const heroPost = sortedPosts[0];

// 2. Latest News (Next 5)
const latestNews = sortedPosts.slice(1, 6);
const mainLatest = latestNews[0];
const sideLatest = latestNews.slice(1);

// 3. Category Specific
const googleNews = sortedPosts.filter(p => p.data.category === 'Google').slice(0, 4);
const chatGPTNews = sortedPosts.filter(p => p.data.category === 'ChatGPT').slice(0, 4);
const claudeNews = sortedPosts.filter(p => p.data.category === 'Claude').slice(0, 4);
const evalNews = sortedPosts.filter(p => p.data.category === 'ModelEval').slice(0, 4);
---

<BaseLayout title="Home">


  {/* Hero Section */}
  {heroPost && <HeroSection post={heroPost} />}

  {/* Latest News */}
  <section class="mb-16">
    <SectionTitle title="Latest News" />
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      {/* Main Latest Card */}
      {mainLatest && (
        <div class="lg:col-span-2">
          <ArticleCard post={mainLatest} class="h-full" />
        </div>
      )}
      
      {/* Side Cards */}
      <div class="space-y-6">
        {sideLatest.map(post => (
          <ArticleCard post={post} horizontal={true} />
        ))}
      </div>
    </div>
  </section>

  {/* Google Updates */}
  {googleNews.length > 0 && (
    <section class="mb-16">
      <SectionTitle title="Google Updates" link="/google" />
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="md:col-span-2 bg-news-black text-white p-6">
          <ArticleCard post={googleNews[0]} class="text-white" />
        </div>
        <div class="md:col-span-2 grid grid-cols-1 gap-6">
           {googleNews.slice(1).map(post => <ArticleCard post={post} horizontal={true} />)}
        </div>
      </div>
    </section>
  )}

  {/* ChatGPT & Claude */}
  {(chatGPTNews.length > 0 || claudeNews.length > 0) && (
    <section class="mb-16">
      <SectionTitle title="ChatGPT & Claude" link="/chatgpt" />
      <ArticleGrid>
        {chatGPTNews.map(post => <ArticleCard post={post} />)}
        {claudeNews.map(post => <ArticleCard post={post} />)}
      </ArticleGrid>
    </section>
  )}

  {/* Model Evaluation */}
  {evalNews.length > 0 && (
    <section class="mb-16">
      <SectionTitle title="Model Evaluation & Benchmarks" link="/evals" />
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {evalNews.map(post => <PodcastCard post={post} />)}
      </div>
    </section>
  )}

</BaseLayout>

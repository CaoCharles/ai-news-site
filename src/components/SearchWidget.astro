<div id="search-container" class="relative">
  <button id="search-toggle" class="hover:text-news-accent transition-colors" aria-label="Search">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
  </button>

  <div id="search-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-20">
    <div class="bg-white w-full max-w-2xl rounded-lg shadow-2xl p-6 mx-4 relative">
      <div class="flex items-center border-b border-gray-200 pb-4 mb-4">
        <svg class="text-gray-400 mr-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input 
          type="text" 
          id="search-input" 
          placeholder="Search AI News..." 
          class="w-full text-xl outline-none placeholder:text-gray-300 font-serif"
        />
        <button id="search-close" class="ml-4 text-gray-400 hover:text-black">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
      </div>
      
      <div id="search-results" class="max-h-[60vh] overflow-y-auto space-y-4">
        {/* Results will be populated here */}
        <p class="text-gray-400 text-center py-8">Start typing to search...</p>
      </div>
    </div>
  </div>
</div>

<script>
  const searchToggle = document.getElementById('search-toggle');
  const searchModal = document.getElementById('search-modal');
  const searchClose = document.getElementById('search-close');
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');

  let posts = [];

  // Toggle Modal
  searchToggle?.addEventListener('click', async () => {
    searchModal?.classList.remove('hidden');
    searchInput?.focus();
    if (posts.length === 0) {
      const res = await fetch(import.meta.env.BASE_URL.replace(/\/$/, '') + '/search.json');
      posts = await res.json();
    }
  });

  // Close Modal
  const closeSearch = () => {
    searchModal?.classList.add('hidden');
    if(searchInput) searchInput.value = '';
    if(searchResults) searchResults.innerHTML = '<p class="text-gray-400 text-center py-8">Start typing to search...</p>';
  };

  searchClose?.addEventListener('click', closeSearch);
  searchModal?.addEventListener('click', (e) => {
    if (e.target === searchModal) closeSearch();
  });

  // Search Logic
  searchInput?.addEventListener('input', (e) => {
    const query = (e.target as HTMLInputElement).value.toLowerCase();
    if (!query) {
      if(searchResults) searchResults.innerHTML = '<p class="text-gray-400 text-center py-8">Start typing to search...</p>';
      return;
    }

    const filtered = posts.filter(post => 
      post.title.toLowerCase().includes(query) || 
      post.description.toLowerCase().includes(query)
    );

    if (searchResults) {
      if (filtered.length === 0) {
        searchResults.innerHTML = '<p class="text-gray-500 text-center py-8">No results found.</p>';
      } else {
        searchResults.innerHTML = filtered.map(post => `
          <a href="${import.meta.env.BASE_URL.replace(/\/$/, '')}/posts/${post.slug}" class="block p-4 hover:bg-gray-50 rounded-lg transition-colors group">
            <div class="flex items-center gap-2 text-xs font-bold text-news-accent uppercase mb-1">
              ${post.category}
            </div>
            <h3 class="text-lg font-bold font-serif group-hover:underline">${post.title}</h3>
            <p class="text-sm text-gray-500 line-clamp-1">${post.description}</p>
          </a>
        `).join('');
      }
    }
  });
</script>
